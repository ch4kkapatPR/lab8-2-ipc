<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab 8.2 - IPC Communication Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Sarabun', Tahoma, 'Noto Sans Thai', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .demo-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    .input-group {
      margin: 15px 0;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .input-group input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .button {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid white;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
      transition: all 0.3s ease;
    }
    
    .button:hover {
      background: white;
      color: #667eea;
      transform: translateY(-2px);
    }
    
    .result-box {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .loading {
      color: #ffd700;
      font-style: italic;
    }
    
    .success {
      color: #90ee90;
    }
    
    .error {
      color: #ff6b6b;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”„ IPC Communication Demo</h1>
      <p>à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Main Process à¹à¸¥à¸° Renderer Process</p>
    </div>

    <!-- Login Section -->
<div class="demo-section" id="loginSection">
  <h3>ğŸ” à¸£à¸°à¸šà¸š Login Agent</h3>
  <div class="input-group">
    <label>Agent ID:</label>
    <input type="text" id="loginAgentId" placeholder="Agent001">
  </div>
  <div class="input-group">
    <label>Password:</label>
    <input type="password" id="loginPassword" placeholder="à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™">
  </div>
  <button class="button" onclick="login()">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
  <div class="result-box" id="loginResult">à¸à¸£à¸¸à¸“à¸²à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</div>
</div>

<!-- Dashboard Section -->
<div id="dashboardSection" style="display: none;">
  <p>à¸ªà¸§à¸±à¸ªà¸”à¸µ, <span id="currentAgentName"></span> ğŸ‘‹</p>
  <!-- à¸ªà¹ˆà¸§à¸™ Agent Wallboard à¹€à¸”à¸´à¸¡à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¸™à¸µà¹ˆ -->
</div>

    <!-- Demo 1: à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸à¸·à¹‰à¸™à¸à¸²à¸™ -->
    <div class="demo-section">
      <h3>ğŸ“¤ Demo 1: à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸› Main Process</h3>
      <p>à¸—à¸”à¸ªà¸­à¸šà¸à¸²à¸£à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸¥à¸°à¸£à¸±à¸š response à¸à¸¥à¸±à¸šà¸¡à¸²</p>
      
      <div class="input-group">
        <label>à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¹ˆà¸‡:</label>
        <input type="text" id="messageInput" placeholder="à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸™à¸µà¹ˆ..." value="Hello from Renderer Process!">
      </div>
      
      <button class="button" onclick="sendMessage()">ğŸ“¤ à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</button>
      <button class="button" onclick="clearResult('messageResult')">ğŸ§¹ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</button>
      
      <div class="result-box" id="messageResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡" à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸š IPC</div>
    </div>

    <!-- Demo 2: à¸£à¸°à¸šà¸šà¸—à¸±à¸à¸—à¸²à¸¢ -->
    <div class="demo-section">
      <h3>ğŸ‘‹ Demo 2: à¸£à¸°à¸šà¸šà¸—à¸±à¸à¸—à¸²à¸¢ Agent</h3>
      <p>à¸ˆà¸³à¸¥à¸­à¸‡à¸à¸²à¸£ login à¹à¸¥à¸°à¸—à¸±à¸à¸—à¸²à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¹ƒà¸™ agent wallboard</p>
      
<div class="demo-section">
  <h3>ğŸ“Š Demo 3: Agent Wallboard Functions</h3>
  <p>à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents (à¹€à¸•à¸£à¸µà¸¢à¸¡à¸ªà¸³à¸«à¸£à¸±à¸š wallboard app)</p>
  
  <button class="button" onclick="loadAgents()">ğŸ“Š à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Agents</button>
  <button class="button" onclick="showStatusSelector()">ğŸ”„ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°</button>
  <button class="button" onclick="clearResult('agentResult')">ğŸ§¹ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</button>
  
  <div id="statusSelector" style="display: none; margin: 15px 0;">
    <select id="agentSelect" style="padding: 8px; margin-right: 10px;">
      <option value="">à¹€à¸¥à¸·à¸­à¸ Agent</option>
    </select>
    
    <select id="statusSelect" style="padding: 8px; margin-right: 10px;">
      <option value="Available">Available</option>
      <option value="Busy">Busy</option>
      <option value="Break">Break</option>
      <option value="Offline">Offline</option>
    </select>
    
    <button class="button" onclick="changeStatus()">âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™</button>
  </div>
  
  <div class="result-box" id="agentResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Agents" à¹€à¸à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™</div>
</div>

      <div class="input-group">
        <label>à¸Šà¸·à¹ˆà¸­ Agent:</label>
        <input type="text" id="agentName" placeholder="à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“..." value="Agent001">
      </div>
      
      <button class="button" onclick="sayHello()">ğŸ‘‹ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
      <button class="button" onclick="clearResult('helloResult')">ğŸ§¹ à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</button>
      
      <div class="result-box" id="helloResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š" à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸šà¸£à¸°à¸šà¸šà¸—à¸±à¸à¸—à¸²à¸¢</div>
    </div>

    <!-- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Process -->
    <div class="demo-section">
      <h3>ğŸ“Š Process Information</h3>
      <div class="result-box">
ğŸ–¥ï¸ <strong>Main Process:</strong> à¸—à¸³à¸‡à¸²à¸™à¹ƒà¸™ Node.js environment, à¸ˆà¸±à¸”à¸à¸²à¸£ business logic
ğŸ¨ <strong>Renderer Process:</strong> à¸—à¸³à¸‡à¸²à¸™à¹ƒà¸™ Chromium environment, à¹à¸ªà¸”à¸‡ UI
ğŸŒ‰ <strong>Preload Script:</strong> à¸•à¸±à¸§à¸à¸¥à¸²à¸‡à¸—à¸µà¹ˆà¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸ªà¸³à¸«à¸£à¸±à¸š IPC communication

<strong>ğŸ”„ à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™:</strong>
1. Renderer à¹€à¸£à¸µà¸¢à¸ window.electronAPI.sendMessage()
2. Preload à¸ªà¹ˆà¸‡à¸•à¹ˆà¸­à¹„à¸› Main à¸”à¹‰à¸§à¸¢ ipcRenderer.invoke()
3. Main à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸”à¹‰à¸§à¸¢ ipcMain.handle()
4. Main à¸ªà¹ˆà¸‡ response à¸à¸¥à¸±à¸š
5. Renderer à¹„à¸”à¹‰à¸£à¸±à¸šà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ
      </div>
    </div>
  </div>

  <script>
    console.log('ğŸ¨ [RENDERER] à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...');

async function login() {
  const agentId = document.getElementById('loginAgentId').value;
  const password = document.getElementById('loginPassword').value;

  const resultBox = document.getElementById('loginResult');
  resultBox.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š...';
  resultBox.className = 'result-box loading';

  try {
    const response = await window.electronAPI.login(agentId, password);
    console.log('Login response:', response); 

    if (response.success) {
      resultBox.textContent = `à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸š ${response.agent.name} ğŸ‘‹`;
      resultBox.className = 'result-box success';
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('dashboardSection').style.display = 'block';
      document.getElementById('currentAgentName').textContent = response.agent.name;
    } else {
      resultBox.textContent = response.error;
      resultBox.className = 'result-box error';
    }
  } catch (err) {
    console.error('Login error:', err);
    resultBox.textContent = `à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: ${err.message}`;
    resultBox.className = 'result-box error';
  }
}

    // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² electronAPI à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
    if (window.electronAPI) {
      console.log('âœ… [RENDERER] electronAPI à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™');
    } else {
      console.error('âŒ [RENDERER] electronAPI à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™');
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹à¸ªà¸”à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ
    function displayResult(elementId, data, type = 'info') {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString('th-TH');
      
      let content;
      if (typeof data === 'object') {
        content = JSON.stringify(data, null, 2);
      } else {
        content = data.toString();
      }
      
      element.innerHTML = `[${timestamp}] ${content}`;
      element.className = `result-box ${type}`;
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
    async function sendMessage() {
      const message = document.getElementById('messageInput').value;
      
      if (!message.trim()) {
        displayResult('messageResult', 'à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡', 'error');
        return;
      }

      try {
        console.log('ğŸ“¤ [RENDERER] à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡:', message);
        displayResult('messageResult', 'à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡...', 'loading');
        
        // à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸› Main Process
        const response = await window.electronAPI.sendMessage(message);
        
        console.log('ğŸ“¥ [RENDERER] à¹„à¸”à¹‰à¸£à¸±à¸š response:', response);
        displayResult('messageResult', response, 'success');
        
      } catch (error) {
        console.error('âŒ [RENDERER] Error:', error);
        displayResult('messageResult', `Error: ${error.message}`, 'error');
      }
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸—à¸±à¸à¸—à¸²à¸¢
    async function sayHello() {
      const name = document.getElementById('agentName').value;
      
      if (!name.trim()) {
        displayResult('helloResult', 'à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­ Agent', 'error');
        return;
      }

      try {
        console.log('ğŸ‘‹ [RENDERER] à¸à¸³à¸¥à¸±à¸‡à¸—à¸±à¸à¸—à¸²à¸¢:', name);
        displayResult('helloResult', 'à¸à¸³à¸¥à¸±à¸‡à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š...', 'loading');
        
        // à¸ªà¹ˆà¸‡à¸„à¸³à¸—à¸±à¸à¸—à¸²à¸¢à¹„à¸› Main Process
        const response = await window.electronAPI.sayHello(name);
        
        console.log('ğŸ“¥ [RENDERER] à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸±à¸à¸—à¸²à¸¢:', response);
        
        // à¹à¸ªà¸”à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹à¸šà¸šà¸ªà¸§à¸¢à¸‡à¸²à¸¡
        const resultText = `
ğŸ‰ à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ!

ğŸ‘¤ Agent: ${response.name}
ğŸ’¬ à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡: ${response.greeting}
â° à¹€à¸§à¸¥à¸²: ${response.time}
ğŸ‘¥ Agents à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ: ${response.agentCount} à¸„à¸™

âœ… à¸à¸£à¹‰à¸­à¸¡à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§!`;

        displayResult('helloResult', resultText, 'success');
        
      } catch (error) {
        console.error('âŒ [RENDERER] Error:', error);
        displayResult('helloResult', `Error: ${error.message}`, 'error');
      }
    }

    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ
    function clearResult(elementId) {
      const element = document.getElementById(elementId);
      element.innerHTML = 'à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹à¸¥à¹‰à¸§...';
      element.className = 'result-box';
    }

    // Event Listeners
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    document.getElementById('agentName').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sayHello();
      }
    });

// à¸•à¸±à¸§à¹à¸›à¸£à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents
let agentsData = null;

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents
async function loadAgents() {
  try {
    console.log('ğŸ“Š [RENDERER] à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents...');
    displayResult('agentResult', 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents...', 'loading');
    
    // à¹€à¸£à¸µà¸¢à¸ API à¸œà¹ˆà¸²à¸™ IPC
    const response = await window.electronAPI.getAgents();
    
    if (response.success) {
      agentsData = response.data;
      console.log('âœ… [RENDERER] à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ:', agentsData);
      
      // à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents
      displayAgentData(agentsData);
      
      // à¸­à¸±à¸à¹€à¸”à¸— dropdown à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°
      updateAgentSelector(agentsData.agents);
      
    } else {
      throw new Error(response.error);
    }
    
  } catch (error) {
    console.error('âŒ [RENDERER] Error à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥:', error);
    displayResult('agentResult', `Error: ${error.message}`, 'error');
  }
}

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents
function displayAgentData(data) {
  const agentList = data.agents.map(agent => {
    const statusEmoji = {
      'Available': 'ğŸŸ¢',
      'Busy': 'ğŸ”´', 
      'Break': 'ğŸŸ¡',
      'Offline': 'âš«'
    };
    
    return `${statusEmoji[agent.status] || 'â“'} ${agent.name} (${agent.id})
   ğŸ“ Ext: ${agent.extension} | ğŸ¢ ${agent.department}
   ğŸ“Š Calls: ${agent.totalCalls} | â±ï¸ Avg: ${agent.avgCallTime}s`;
  }).join('\n\n');
  
  const statistics = data.statistics;
  
  const resultText = `
ğŸ“Š AGENT WALLBOARD DATA
======================

ğŸ‘¥ AGENTS (${statistics.totalAgents} à¸„à¸™):
${agentList}

ğŸ“ˆ STATISTICS:
ğŸŸ¢ Available: ${statistics.availableAgents} à¸„à¸™
ğŸ”´ Busy: ${statistics.busyAgents} à¸„à¸™  
ğŸŸ¡ Break: ${statistics.onBreakAgents} à¸„à¸™
ğŸ“ Total Calls Today: ${statistics.totalCallsToday}
â° Avg Wait Time: ${statistics.avgWaitTime}s

â° Last Updated: ${new Date().toLocaleString('th-TH')}`;

  displayResult('agentResult', resultText, 'success');
}

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸­à¸±à¸à¹€à¸”à¸— dropdown à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸¥à¸·à¸­à¸ agent
function updateAgentSelector(agents) {
  const agentSelect = document.getElementById('agentSelect');
  agentSelect.innerHTML = '<option value="">à¹€à¸¥à¸·à¸­à¸ Agent</option>';
  
  agents.forEach(agent => {
    const option = document.createElement('option');
    option.value = agent.id;
    option.textContent = `${agent.name} (${agent.id}) - ${agent.status}`;
    agentSelect.appendChild(option);
  });
}

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹à¸ªà¸”à¸‡/à¸‹à¹ˆà¸­à¸™ status selector
function showStatusSelector() {
  if (!agentsData) {
    displayResult('agentResult', 'à¸à¸£à¸¸à¸“à¸²à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ agents à¸à¹ˆà¸­à¸™', 'error');
    return;
  }
  
  const selector = document.getElementById('statusSelector');
  selector.style.display = selector.style.display === 'none' ? 'block' : 'none';
}

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸° agent
async function changeStatus() {
  const agentId = document.getElementById('agentSelect').value;
  const newStatus = document.getElementById('statusSelect').value;
  
  if (!agentId || !newStatus) {
    displayResult('agentResult', 'à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸ Agent à¹à¸¥à¸° Status', 'error');
    return;
  }
  
  try {
    console.log(`ğŸ”„ [RENDERER] à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸° ${agentId} à¹€à¸›à¹‡à¸™ ${newStatus}`);
    displayResult('agentResult', `à¸à¸³à¸¥à¸±à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸° ${agentId}...`, 'loading');
    
    // à¹€à¸£à¸µà¸¢à¸ API à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°
    const response = await window.electronAPI.changeAgentStatus(agentId, newStatus);
    
    if (response.success) {
      console.log('âœ… [RENDERER] à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¸ªà¸³à¹€à¸£à¹‡à¸ˆ:', response);
      
      const resultText = `
âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!

ğŸ‘¤ Agent: ${response.agent.name} (${response.agent.id})
ğŸ”„ Status: ${response.agent.status}
â° à¹€à¸§à¸¥à¸²: ${new Date(response.agent.lastStatusChange).toLocaleString('th-TH')}

${response.message}`;

      displayResult('agentResult', resultText, 'success');
      
      // à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆà¹€à¸à¸·à¹ˆà¸­à¹à¸ªà¸”à¸‡à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡
      setTimeout(() => {
        loadAgents();
      }, 2000);
      
    } else {
      throw new Error(response.error);
    }
    
  } catch (error) {
    console.error('âŒ [RENDERER] Error à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°:', error);
    displayResult('agentResult', `Error: ${error.message}`, 'error');
  }
}

function showNotification(agent) {
  alert(`ğŸ“¢ Agent ${agent.name} (${agent.id}) à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¹€à¸›à¹‡à¸™ ${agent.status} â° ${new Date(agent.time).toLocaleTimeString('th-TH')}`);
}

// à¹€à¸£à¸´à¹ˆà¸¡à¸Ÿà¸±à¸‡ Notification à¹€à¸¡à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸” Dashboard
window.addEventListener('DOMContentLoaded', () => {
  if (window.electronAPI) {
    window.electronAPI.onAgentStatusChanged((agent) => {
      console.log('ğŸ”” [RENDERER] Agent status changed:', agent);
      showNotification(agent);
    });
  }
});

    // à¹€à¸¡à¸·à¹ˆà¸­ page à¹‚à¸«à¸¥à¸”à¹€à¸ªà¸£à¹‡à¸ˆ
    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ“„ [RENDERER] HTML à¹‚à¸«à¸¥à¸”à¹€à¸ªà¸£à¹‡à¸ˆ');
    });

    window.addEventListener('load', () => {
      console.log('âœ… [RENDERER] à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸£à¹‰à¸­à¸¡à¹à¸¥à¹‰à¸§');
    });
  </script>
</body>
</html>